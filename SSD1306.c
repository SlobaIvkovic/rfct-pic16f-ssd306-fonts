/*
 * File:   SSD1306.c
 * Author: Sloba
 *
 * Created on 24.12.2022., 15.55
 */

#include "soft_I2C.h"
#include "SSD1306.h"
#include "SSD1306_defines.h"
#include <xc.h>
#include <stdint.h>

extern const char fontBasicChars[];

void SSD1306_command(uint8_t c, uint8_t address) 
{   
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x00);          // Send command
    I2C_WriteByte(c);
    I2C_Stop();
    
}

void SSD1306_Init(uint8_t vccstate) 
{
    SSD1306_cmd(0xAE);
    SSD1306_cmd(0xD5);
    SSD1306_cmd(0x80);
    SSD1306_cmd(0xA8);
    SSD1306_cmd(63);                // HEight - 1
    SSD1306_cmd(0xD3);
    SSD1306_cmd(0x00);
    SSD1306_cmd(0x00);
    
    // Charge pump
    SSD1306_cmd(0x8D);
    SSD1306_cmd(0x14);        // DEPENDS ON external VCC 
    
    //
    SSD1306_cmd(0x20);
    SSD1306_cmd(0x00);
    
    // SEGREMAP
    SSD1306_cmd(0xA1);
    // COMSCANDEC
    SSD1306_cmd(0xC8);
    
    // COMPINS and Contrast
    // COMPINS FOR 128 X 64 DISPLAY
    SSD1306_cmd(0xDA);
    SSD1306_cmd(0x12);
    
    // CONTRAST
    SSD1306_cmd(0x81);
    SSD1306_cmd(0xCF);      // DEPENDS ON extenrnal VCC value
    
    
    // SET PRECHARGE
    SSD1306_cmd(0xD9);
    SSD1306_cmd(0xF1);      // DEPENDS ON extenrnal VCC value
    
    
    //
    
    SSD1306_cmd(0xD8);
    SSD1306_cmd(0x40);
    SSD1306_cmd(0xA4);
    SSD1306_cmd(0xA6);
    
    // Deactivate scroll
    SSD1306_cmd(0x2E);
    
    //
    SSD1306_clear();
    
    // DISPLAY ON
//    SSD1306_cmd(0xAF);
    
}


void SSD1306_clear()
{
    SSD1306_cmd(SSD1306_PAGEADDR);
    SSD1306_cmd(0);              // page start address
    SSD1306_cmd(7);              // page end address, every page consists of 8 rows, 8*8=64px height
    
    SSD1306_cmd(SSD1306_COLUMNADDR);
    SSD1306_cmd(0);
    SSD1306_cmd(127);
    
    // when the byte is written all 8 dots (rows) at given page at given column are written
    /*
     * example byte sent 0xAA 10101010
     *  col   0 1 2 3 ....
     * row  0 x
     * row  1
     * row  2 x
     * row  3
     * row  4 x
     * row  5
     * row  6 x
     * row  7 
     */
    
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    int i;
    for(i = 0; i < 128 * 8; i++)
    {
        I2C_WriteByte(0x00);
    }
    
    I2C_Stop();
}

extern const unsigned char font[];



/*
const unsigned char font[] = {
0x08, 0xc0, 0xdc, 0xfe, 0xff, 0xe7, 0xc7, 0xc7, 0xc3, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0b, 0x00, 0x06, 0x02, 0x02, 0xe2, 0xe6, 0xe4, 0x04, 0x06, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x05, 0x10, 0x9e, 0x92, 0x92, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0a, 0x00, 0x00, 0x60, 0x7e, 0x7f, 0x63, 0x63, 0x61, 0x00, 0x00, 0xf0, 0xfc, 0xfe, 0x8e, 0x07, 0x07, 0x0f, 0xfe, 0xfe, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x05, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x13, 0x60, 0x7e, 0x7f, 0x63, 0x63, 0x61, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xf0, 0xf0, 0x38, 0x38, 0x38, 0x38, 0x70, 0x00, 0x38, 0xfe, 0xfe, 0xc6, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x07, 0x87, 0xcf, 0xfe, 0xfc, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x03, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x13, 0xfc, 0xfc, 0xfc, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0x80, 0xff, 0xff, 0xff, 0x00, 0x01, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x33, 0x73, 0x73, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0a, 0x80, 0xc0, 0xe3, 0xe7, 0x77, 0x70, 0xf3, 0xe7, 0xe3, 0x80, 0x0f, 0x3f, 0x3f, 0x78, 0x70, 0x70, 0x70, 0x7f, 0x7f, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x13, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x03, 0x07, 0x03, 0x00, 0x03, 0x07, 0x07, 0x00, 0x00, 0x00, 0xe0, 0xe0, 0xe0, 0x1f, 0x3f, 0x7f, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x7f, 0x7f, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x70, 0x76, 0x07, 0x36, 0x70, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xf8, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xfe, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0x00, 0x00, 0x00, 0x0e, 0x07, 0x07, 0x07, 0x0f, 0xfe, 0xfe, 0xf0, 0x80, 0x00, 0xf8, 0xfc, 0xfe, 0x8e, 0x07, 0x67, 0x77, 0x67, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0x00, 0x00, 0x00, 0x0e, 0x07, 0x07, 0x07, 0x0f, 0x7f, 0xfe, 0xf8, 0x80, 0x00, 0xf8, 0xfc, 0xfe, 0x8e, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0x00, 0x00, 0x00, 0xe0, 0x73, 0x77, 0x77, 0xf0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe0, 0xe0, 0x70, 0x70, 0x70, 0x70, 0x7f, 0x7f, 0x7f, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0a, 0x00, 0x00, 0x07, 0x07, 0x07, 0x07, 0x0f, 0xfe, 0xfe, 0xf8, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0a, 0x00, 0x70, 0x73, 0x77, 0x77, 0x70, 0xf0, 0xe0, 0xe0, 0x80, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x7f, 0x7f, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x08, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x70, 0x70, 0x70, 0x70, 0x3f, 0x3f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe3, 0xe7, 0xe7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x1b, 0xc0, 0xf0, 0xe0, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfc, 0xfc, 0xfc, 0xc0, 0x80, 0x80, 0x80, 0xfe, 0xfe, 0xfe, 0x80, 0x80, 0x80, 0xff, 0xff, 0xff, 0x07, 0x1f, 0x3f, 0x38, 0x78, 0x70, 0x70, 0x70, 0x70, 0x78, 0x3c, 0x3f, 0x1f, 0x07, 0x03, 0x03, 0x03, 0x03, 0x03,
0x1b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x70, 0x77, 0x07, 0x36, 0x70, 0x30, 0x00, 0x00, 0x00, 0x00, 0x80, 0xe0, 0xc0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xf8, 0xf8, 0x80, 0x00, 0x00, 0x00, 0xfc,
0x1a, 0x80, 0xe0, 0xc0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xfe, 0xfe, 0x3c, 0x1c, 0x0e, 0x07, 0x07, 0x07, 0x07, 0x0f, 0xfe, 0xfc, 0xf8, 0x00, 0x0f, 0x3f, 0x7f, 0x70, 0xf0, 0xe0, 0xe0, 0xe0, 0xe0, 0xf0, 0x78, 0x7f, 0x3f, 0x0f, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07,
0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xe0, 0xe0, 0xc0, 0xc0, 0xe0, 0x70, 0x73, 0x77, 0x77, 0x70, 0xf0, 0xe0, 0xc0, 0x00, 0xf8, 0xfe, 0xfc, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xff, 0xff, 0xff, 0x77, 0x71, 0x70, 0x70, 0x70, 0x70,
0x11, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0xff, 0xff, 0xff, 0x9e, 0x8f, 0x87, 0x83, 0x83, 0x83, 0x83, 0x87, 0xff, 0xfe, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x11, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x98, 0xb8, 0xb8, 0x80, 0x00, 0x00, 0x00, 0x00, 0x80, 0x80, 0x80, 0xff, 0xff, 0xff, 0x9e, 0x8f, 0x87, 0x83, 0x83, 0x83, 0x83, 0x87, 0xff, 0xfe, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0c, 0x00, 0x00, 0x78, 0xfe, 0xfe, 0x8f, 0x87, 0x07, 0x07, 0x07, 0x00, 0x00, 0xf8, 0xfc, 0xfe, 0x8e, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0c, 0x00, 0x00, 0x80, 0xe0, 0xe0, 0xf0, 0x73, 0x77, 0x73, 0x70, 0x00, 0x00, 0x80, 0xc0, 0xe7, 0xef, 0x7f, 0x78, 0x78, 0x70, 0x70, 0x70, 0x70, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x06, 0x02, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x16, 0x80, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xc0, 0xe0, 0xe0, 0x73, 0x77, 0x73, 0xf0, 0xe0, 0xe0, 0x80, 0x1f, 0x3f, 0x7f, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x70, 0x7f, 0x7f, 0x7f, 0x78, 0x70, 0x70, 0x70, 0x70, 0x7f, 0x7f, 0x7f, 0x00, 0x00,
0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x80, 0xc0, 0xe3, 0xe7, 0x77, 0x70, 0xf3, 0xe7, 0xe3, 0x80, 0xe0, 0xf8, 0xf8, 0x10, 0x00, 0x00, 0x0f, 0x3f, 0x3f, 0x78, 0x70, 0x70, 0x70, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x13, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xe0, 0xe0, 0x20, 0x20, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xfc, 0xfc, 0xfc, 0x80, 0x80, 0x80, 0x80, 0x81, 0x81, 0x81, 0x81, 0x81, 0x80, 0x80, 0x80, 0x80, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xfe, 0xfe, 0xfe, 0x80, 0xe0, 0xe0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf8, 0xfc, 0xfe, 0x0f, 0x07, 0x07, 0x07, 0x8f, 0xfe, 0xfc, 0xf8, 0xfc, 0xfe, 0xff, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0e, 0x00, 0x80, 0x80, 0x00, 0x00, 0x00, 0x07, 0x07, 0x07, 0x00, 0xc0, 0xe0, 0xe0, 0x00, 0x3e, 0xff, 0xff, 0xe1, 0xc0, 0x80, 0x80, 0x80, 0x80, 0xc0, 0xe0, 0xff, 0xff, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0a, 0xf8, 0xfc, 0xfe, 0x8e, 0x07, 0x07, 0x0f, 0xfe, 0xfe, 0xf8, 0x00, 0x03, 0x03, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0a, 0xf0, 0xfc, 0xfe, 0x8e, 0x07, 0x07, 0x0f, 0xfe, 0xfe, 0xf8, 0x00, 0xc3, 0xc3, 0xc7, 0xc7, 0xc7, 0xe7, 0xff, 0x7f, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x12, 0x80, 0xe0, 0xe0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x7e, 0xfe, 0xe7, 0xc7, 0x87, 0x07, 0x0e, 0x00, 0x0f, 0x3f, 0x7f, 0x78, 0xf0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x70, 0x79, 0x3f, 0x3f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x12, 0x80, 0xe0, 0xe0, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x38, 0x7e, 0xfe, 0xe7, 0xc7, 0x87, 0x07, 0x0e, 0x00, 0x0f, 0x3f, 0x7f, 0x78, 0xf0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0xe0, 0x70, 0x79, 0x3f, 0x3f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x06, 0x00, 0x2c, 0x24, 0x14, 0x16, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x07, 0x00, 0x04, 0x04, 0x08, 0x0e, 0x09, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x06, 0x00, 0x24, 0x34, 0x16, 0x12, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x06, 0x04, 0x04, 0x04, 0x02, 0x02, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x07, 0x00, 0x08, 0x08, 0x0a, 0x0d, 0x05, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x06, 0x0c, 0x04, 0x04, 0x06, 0x02, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x08, 0x0e, 0x10, 0x10, 0x0e, 0x10, 0x10, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x04, 0x0e, 0x11, 0x11, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0a, 0x02, 0x02, 0x02, 0x02, 0x06, 0x04, 0x04, 0x04, 0x06, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x05, 0x00, 0x14, 0x1e, 0x12, 0x12, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x05, 0x00, 0x0a, 0x0f, 0x09, 0x09, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x01, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x04, 0x0f, 0x08, 0x08, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0d, 0xff, 0x01, 0x01, 0x21, 0x31, 0x09, 0x09, 0x19, 0xf1, 0x01, 0x01, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x6e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};
*/

int checkAgain(char* index, int* current)
{
    int i;
    if(index[*current] == '\0')
    {
        return -1;
    }
    
 /*   if(!(index[*current] >> 7))
    {
        return 0;
    }
    */
    while(index[*current] < 0xD0)   // 
    {                               // 
    /*    for(i = 0; i < 5; i++)      // 
        {
            I2C_WriteByte(0);
        }*/

        (*current)++;
      
    }
    (*current)++;
    return 0;
}

// Napraviti funkciju koja štampa mali znak pitanja kada ne zna koji je to karakter
// Napraviti funkciju koja štampa interpunkcijske znakove (proveravanje prvog bajta odlučuje koji se font niz bira)

void SSD1306_drawText(uint8_t x, uint8_t y, char* text, const char* font)
{   
    uint8_t xtemp = x;
    unsigned char i, k, j;
    int ind = 0;
    int current = 0;
       
    setXY(x, y);
    
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    while(text[current] != 0)
    {
        j = 0;
        k = 0;
        if(-1 == checkAgain(text, &current))
        {
            break;
        }
        
        if(text[current-1] == 0xD0)
        {
            ind = (text[current] - 0x82) * 47;  // puta 47 za srpski bilo 0x82 za srpski
            for(i = 0; i < 46; i++)      //
            {
                for(j=0; j < font[ind]; j++)
                {
                    I2C_WriteByte(font[ind +1 + i]);
                }
                k++;
                   
                I2C_Stop();
     
                setXY(xtemp, y+k);
    
                    I2C_Start();
                    I2C_WriteByte(0x78);
                    I2C_WriteByte(0x40);
                
                
            /*   if(j == font[ind]) // širina dostignuta na font[ind] se nalazi informacija o širini, preći na sledeću liniju
                {
                   j = 0;
                   k++;
                   
                    I2C_Stop();
     
                    setXY(xtemp, y+k);
    
                    I2C_Start();
                    I2C_WriteByte(0x78);
                    I2C_WriteByte(0x40);
    
                }
                else
                {
                    j++;
                }
                I2C_WriteByte(font[ind +1 + i]);  // + 1 when WIDTH // Na svakih 47 počinje novi karakter, svaki karakter počinje svojom dužinom pa onda se nastavlja 
                                                                // bajtovima za štampanje, 47 je veliki broj, verovatno je prvobitno izabran za velike fontove   
             * */
            }
        }
       /* else //if(!(text[current-1] >> 7)) // MSB bit the byte 0 indicate single byte char ASCII compatible
        {
            ind = (text[current] - 0x20) * 47;  // basic Chars start with space which is ascii 0x20
            for(i = 0; i < 46; i++)      //
            {
                if(i == fontBasicChars[ind]) //
                {
                I2C_Stop();
     
                setXY(xtemp, y+1);
    
                I2C_Start();
                I2C_WriteByte(0x78);
                I2C_WriteByte(0x40);
    
                }
            I2C_WriteByte(font[ind +1 + i]);  // + 1 when WIDTH // Na svakih 47 počinje novi karakter, svaki karakter počinje svojom dužinom pa onda se nastavlja 
                                                                // bajtovima za štampanje, 47 je veliki broj, verovatno je prvobitno izabran za velike fontove   
                }
        }*/
        
        xtemp += font[ind]+1;

        I2C_Stop();
        setXY(xtemp, y);    
        I2C_Start();
        
        I2C_WriteByte(0x78);
        I2C_WriteByte(0x40);
    
        current += 1;
        
    }
    
    I2C_Stop();

}


void SSD1306_printText(uint8_t x, uint8_t y, char* text, const unsigned char* font)
{
    
 //   index = (index - 0xD089) * 8;
    
    uint8_t xtemp = x;
    
    
    setXY(x, y);
    
    
    unsigned char i, j, k;
    int ind = 0;
    int current = 0;
    
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
      
    while(text[current] != 0)
    {
        j=0;
        k = 0;
 
        if(-1 == checkAgain(text, &current))
        {
            break;
        }
        
        if(text[current-1] == 0xD0)
        {
            ind = (text[current] - 0x82) * 47;  // puta 47 za srpski bilo 0x82 za srpski
            for(i = 0; i < 46; i++)      //
            {
                if(j == font[ind]) // širina dostignuta na font[ind] se nalazi informacija o širini, preći na sledeću liniju
                {
                    
                    j=0;  // y must revert back to its original value for the next letter, +1 aint enough if text is 3 stupca
                k++;
                I2C_Stop();
                
                
                setXY(xtemp, y+k);
    
                I2C_Start();
                I2C_WriteByte(0x78);
                I2C_WriteByte(0x40);
    
                }
               else
                j++;
            I2C_WriteByte(font[ind + 1 + i]);  // + 1 when WIDTH // Na svakih 47 počinje novi karakter, svaki karakter počinje svojom dužinom pa onda se nastavlja 
                                                                // bajtovima za štampanje, 47 je veliki broj, verovatno je prvobitno izabran za velike fontove   
            }
        //    if(text[current+1] != '\0')
        //    {
        //    current += 1;
            
        //    }
        
        }
    //    else if(!(text[current] >> 7)) // Asci chars are 1 byte long and MSB is 0
        /*{
            if(text[current] == '\0')  // 
            {
                break;
            }
            ind = (text[current] - 0x20) * 47;  // basic Chars start with space which is ascii 0x20
            for(i = 0; i < 46; i++)      //
            {
                if(i == fontBasicChars[ind]) //
                {
                I2C_Stop();
     
                setXY(xtemp, y+1);
    
                I2C_Start();
                I2C_WriteByte(0x78);
                I2C_WriteByte(0x40);
    
                }
                I2C_WriteByte(fontBasicChars[ind +1 + i]);  // + 1 when WIDTH // Na svakih 47 počinje novi karakter, svaki karakter počinje svojom dužinom pa onda se nastavlja 
                                                                // bajtovima za štampanje, 47 je veliki broj, verovatno je prvobitno izabran za velike fontove   
            }
            current++;
            xtemp += font[ind];
        }*/
        
        
        xtemp += font[ind]+1;

        I2C_Stop();
        setXY(xtemp, y);
        
        
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    current+=1;
        
        
    }
    
    I2C_Stop();

}



void SSD1306_drawArabicText(uint8_t x, uint8_t y, char* text)
{
    
 //   index = (index - 0xD089) * 8;
    
    uint8_t xtemp = x;
    
    
    setXY(x, y);
    
    
    int i;
    int ind = 0;
    int current = 0;
    
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    while(text[current] != 0)
    {
    
        if(-1 == checkAgain(text, &current))
        {
            break;
        }
        
        if(text[current-1] == 0xD8)
        ind = (text[current] - 0xA1) * 47;  //
        else if(text[current-1] == 0xD9)
//        else
        {
            ind = (text[current] - 0x80);
                    ind = 47*(30+ind);
        }
        for(i = 0; i < 46; i++)
        {
            if(i == font[ind]) // širina dostignuta na font[ind] se nalazi informacija o širini, preći na sledeću liniju
            {
               I2C_Stop();
     
               setXY(xtemp, y+1);
    
                I2C_Start();
                I2C_WriteByte(0x78);
                I2C_WriteByte(0x40);
    
            }
            I2C_WriteByte(font[ind +1 + i]);  // + 1 when WIDTH // Na svakih 47 počinje novi karakter, svaki karakter počinje svojom dužinom pa onda se nastavlja 
                                                                // bajtovima za štampanje, 47 je veliki broj, verovatno je prvobitno izabran za velike fontove
            
        }
        xtemp += font[ind];
     //   w += 2;
        I2C_Stop();
        setXY(xtemp, y);
        
        
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    
        current += 1;
        
    }
    
    I2C_Stop();

}


void setXY(uint8_t x, uint8_t y)
{
    SSD1306_cmd(SSD1306_PAGEADDR);
    SSD1306_cmd(y);              // page start address
    SSD1306_cmd(7);              // page end address, every page consists of 8 rows, 8*8=64px height
    
    SSD1306_cmd(SSD1306_COLUMNADDR);
    SSD1306_cmd(x);
    SSD1306_cmd(127);
}

void writeArabicChar(int width, int numInFont)
{
    
    I2C_Stop();
    setXY(10, 10);
    
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    
    
    int i;
    for(i=0; i < width; i++)
    {
    
    I2C_WriteByte(font[numInFont +1 + i]);
    }
    I2C_Stop();
}