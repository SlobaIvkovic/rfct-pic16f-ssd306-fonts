/*
 * File:   SSD1306.c
 * Author: Sloba
 *
 * Created on 24.12.2022., 15.55
 */

#include "soft_I2C.h"
#include "SSD1306.h"
#include "SSD1306_defines.h"
#include <xc.h>
#include <stdint.h>

void SSD1306_command(uint8_t c, uint8_t address) 
{   
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x00);          // Send command
    I2C_WriteByte(c);
    I2C_Stop();
    
}

void SSD1306_Init(uint8_t vccstate) 
{
    SSD1306_cmd(0xAE);
    SSD1306_cmd(0xD5);
    SSD1306_cmd(0x80);
    SSD1306_cmd(0xA8);
    SSD1306_cmd(63);                // HEight - 1
    SSD1306_cmd(0xD3);
    SSD1306_cmd(0x00);
    SSD1306_cmd(0x00);
    
    // Charge pump
    SSD1306_cmd(0x8D);
    SSD1306_cmd(0x14);        // DEPENDS ON external VCC 
    
    //
    SSD1306_cmd(0x20);
    SSD1306_cmd(0x00);
    
    // SEGREMAP
    SSD1306_cmd(0xA1);
    // COMSCANDEC
    SSD1306_cmd(0xC8);
    
    // COMPINS and Contrast
    // COMPINS FOR 128 X 64 DISPLAY
    SSD1306_cmd(0xDA);
    SSD1306_cmd(0x12);
    
    // CONTRAST
    SSD1306_cmd(0x81);
    SSD1306_cmd(0xCF);      // DEPENDS ON extenrnal VCC value
    
    
    // SET PRECHARGE
    SSD1306_cmd(0xD9);
    SSD1306_cmd(0xF1);      // DEPENDS ON extenrnal VCC value
    
    
    //
    
    SSD1306_cmd(0xD8);
    SSD1306_cmd(0x40);
    SSD1306_cmd(0xA4);
    SSD1306_cmd(0xA6);
    
    // Deactivate scroll
    SSD1306_cmd(0x2E);
    
    //
    SSD1306_clear();
    
    // DISPLAY ON
//    SSD1306_cmd(0xAF);
    
}


void SSD1306_clear()
{
    SSD1306_cmd(SSD1306_PAGEADDR);
    SSD1306_cmd(0);              // page start address
    SSD1306_cmd(7);              // page end address, every page consists of 8 rows, 8*8=64px height
    
    SSD1306_cmd(SSD1306_COLUMNADDR);
    SSD1306_cmd(0);
    SSD1306_cmd(127);
    
    // when the byte is written all 8 dots (rows) at given page at given column are written
    /*
     * example byte sent 0xAA 10101010
     *  col   0 1 2 3 ....
     * row  0 x
     * row  1
     * row  2 x
     * row  3
     * row  4 x
     * row  5
     * row  6 x
     * row  7 
     */
    
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    int i;
    for(i = 0; i < 128 * 8; i++)
    {
        I2C_WriteByte(0x00);
    }
    
    I2C_Stop();
}

const unsigned char font[] = 
{
 0x11, 0x00, 0x03, 0x03, 0xff, 0xff, 0xff, 0xff, 0x33, 0x33, 0x30, 0x30, 0x30, 0x70, 0xe0, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0e, 0xf0, 0xf0, 0xf0, 0xf0, 0x30, 0x30, 0x37, 0x37, 0x33, 0x30, 0x70, 0xf0, 0xf0, 0xf0, 0x3f, 0x3f, 0x3f, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x03, 0x87, 0x87, 0x87, 0xcf, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x10, 0x00, 0x9f, 0x9f, 0x9f, 0x9f, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x73, 0xe7, 0xe7, 0xe7, 0xe7, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x04, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0a, 0x00, 0x07, 0x07, 0xf3, 0xf3, 0xf0, 0xf7, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x3f, 0x3f, 0x3f, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0e, 0xc0, 0xc0, 0x80, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x17, 0x00, 0x80, 0xf3, 0xff, 0xff, 0x3f, 0x0f, 0x03, 0x03, 0x03, 0xff, 0xff, 0xff, 0xff, 0x38, 0x30, 0x30, 0x30, 0x30, 0xf0, 0xe0, 0xe0, 0xe0, 0x02, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
0x17, 0xff, 0xff, 0xff, 0xff, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0xff, 0xff, 0xff, 0x38, 0x38, 0x30, 0x30, 0x30, 0x70, 0xf0, 0xe0, 0xe0, 0xe0, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03,
0x11, 0x00, 0x03, 0x03, 0xff, 0xff, 0xff, 0xff, 0x33, 0x33, 0x30, 0x30, 0x30, 0x70, 0xe0, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0x00, 0x80, 0x8f, 0x87, 0x87, 0xc3, 0xc0, 0xf0, 0xf0, 0xf0, 0xf0, 0x3f, 0x3f, 0x3f, 0x3f, 0x03, 0x03, 0x07, 0x0f, 0x0f, 0x1f, 0x3d, 0x38, 0x30, 0x30, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x12, 0x00, 0x30, 0x30, 0x70, 0xf0, 0xf0, 0xe0, 0xcc, 0x8c, 0x07, 0x07, 0x87, 0xe3, 0xf0, 0xf0, 0x70, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x31, 0x33, 0x37, 0x3f, 0x3f, 0x3f, 0x1f, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x0f, 0x0f, 0x0f, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x10, 0x00, 0x80, 0xf3, 0xff, 0xff, 0x7f, 0x6f, 0x63, 0x63, 0x6f, 0x7f, 0xff, 0xfc, 0xf0, 0x80, 0x00, 0x02, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x3b, 0x3b, 0x33, 0x33, 0x33, 0x33, 0x73, 0xf7, 0xe7, 0xe7, 0xe7, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0x7b, 0xff, 0xff, 0xcf, 0xcf, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0e, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x07, 0x0f, 0x0f, 0x0f, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x12, 0x00, 0x00, 0x00, 0xc0, 0xf8, 0xfe, 0xff, 0x1f, 0x07, 0x03, 0x03, 0x03, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x0f, 0x0f, 0x0f, 0x0f, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x73, 0x73, 0x33, 0x33, 0x33, 0x33, 0x3b, 0xbf, 0x9f, 0x9f, 0x9f, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x14, 0x00, 0x0f, 0x0f, 0x8f, 0xdc, 0xf8, 0xf8, 0x78, 0xff, 0xff, 0xff, 0xff, 0x78, 0xf8, 0xfc, 0xdf, 0x8f, 0x0f, 0x0f, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x10, 0x00, 0x87, 0x87, 0x87, 0x87, 0x03, 0x33, 0x33, 0x33, 0x33, 0x7b, 0x7b, 0xff, 0xff, 0xcf, 0xcf, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0xe0, 0x60, 0x70, 0x30, 0x38, 0x38, 0x1c, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xf0, 0xf0, 0xf0, 0xf0, 0x00, 0x0c, 0x0c, 0x07, 0x87, 0x83, 0xc3, 0xf0, 0xf0, 0xf0, 0xf0, 0x3f, 0x3f, 0x3f, 0x3f, 0x0e, 0x06, 0x07, 0x03, 0x03, 0x03, 0x01, 0x3f, 0x3f, 0x3f, 0x3f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x30, 0x38, 0x78, 0xf8, 0xf8, 0xfc, 0xdc, 0x8f, 0x0f, 0x0f, 0x0f, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x10, 0x00, 0x80, 0xf3, 0xff, 0xff, 0x3f, 0x0f, 0x03, 0x03, 0x0f, 0x3f, 0xff, 0xfc, 0xf0, 0x80, 0x00, 0x02, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x03, 0x03, 0x03, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x13, 0xff, 0xff, 0xfe, 0xfe, 0x0e, 0x0c, 0x0c, 0xfc, 0xfc, 0xfc, 0xfc, 0x0c, 0x0c, 0x0e, 0x06, 0xfe, 0xff, 0xff, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0x30, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x63, 0x63, 0x73, 0x33, 0x33, 0x33, 0x33, 0x3f, 0x3f, 0x1f, 0x1f, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x87, 0x87, 0x87, 0xcf, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x11, 0x0f, 0x0f, 0x0f, 0x0f, 0x03, 0x03, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x0f, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x12, 0x00, 0x03, 0x03, 0x07, 0x0f, 0x1f, 0x3e, 0x7c, 0xf8, 0xf0, 0xf0, 0xf8, 0x7e, 0x3f, 0x0f, 0x07, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x11, 0xfc, 0xfc, 0xfc, 0xfc, 0x0c, 0x0c, 0x0c, 0xff, 0xff, 0xff, 0x0c, 0x0c, 0x0c, 0xfc, 0xfc, 0xfc, 0xfc, 0x0f, 0x0f, 0x0f, 0x0f, 0x0c, 0x0c, 0x0c, 0x3f, 0x3f, 0x3f, 0x0c, 0x0c, 0x0c, 0x0f, 0x0f, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x11, 0x03, 0x03, 0x03, 0x87, 0xcf, 0xff, 0xfe, 0xfc, 0x78, 0xf8, 0xfc, 0xfe, 0xcf, 0x87, 0x03, 0x01, 0x00, 0x00, 0x02, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x12, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x0f, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x10, 0x00, 0x3f, 0x3f, 0x3f, 0x30, 0x30, 0x30, 0x70, 0x70, 0x60, 0x60, 0x60, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x12, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x15, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x0f, 0x0f, 0x0f, 0x0f, 0x00, 0x00, 0x00, 0x00,
0x12, 0x03, 0x03, 0xff, 0xff, 0xff, 0xff, 0x38, 0x38, 0x30, 0x30, 0x30, 0x30, 0x70, 0xf0, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x15, 0xff, 0xff, 0xff, 0xff, 0x38, 0x38, 0x30, 0x30, 0x30, 0x30, 0x70, 0xf0, 0xe0, 0xe0, 0xe0, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00,
0x0f, 0xff, 0xff, 0xff, 0xff, 0x38, 0x38, 0x30, 0x30, 0x30, 0x30, 0x70, 0xf0, 0xe0, 0xe0, 0xe0, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x10, 0x00, 0xcf, 0x87, 0x87, 0x87, 0x03, 0x33, 0x33, 0x33, 0x33, 0x33, 0x33, 0xff, 0xff, 0xff, 0xff, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
0x15, 0xff, 0xff, 0xff, 0xff, 0x30, 0x30, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0xff, 0xff, 0xff, 0xff, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00,
0x10, 0x00, 0x1f, 0x1f, 0x9f, 0xfb, 0xfb, 0xf3, 0xf3, 0x73, 0x33, 0x73, 0x73, 0xff, 0xff, 0xff, 0xff, 0x00, 0x02, 0x03, 0x03, 0x03, 0x03, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x03, 0x03, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
};



int checkAgain(char* index, int* current)
{
    int i;
    if(index[*current] == '\0')
    {
        return -1;
    }
    while(index[*current] < 0xD0)
    {     
        for(i = 0; i < 5; i++)
        {
            I2C_WriteByte(0);
        }
        (*current)++;
        
    }
    (*current)++;
    return 0;
}

void SSD1306_drawText(uint8_t x, uint8_t y, char* text)
{
    
 //   index = (index - 0xD089) * 8;
    
    uint8_t xtemp = x;
    
    
    setXY(x, y);
    
    
    int i;
    int ind = 0;
    int current = 0;
    
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    while(text[current] != 0)
    {
    
        if(-1 == checkAgain(text, &current))
        {
            break;
        }
        
        ind = (text[current] - 0x82) * 47;
        for(i = 0; i < 46; i++)      //font[ind]
        {
            if(i == font[ind]) // širina dostignuta na font[ind] se nalazi informacija o širini, preći na sledeću liniju
            {
               I2C_Stop();
     
               setXY(xtemp, y+1);
    
                I2C_Start();
                I2C_WriteByte(0x78);
                I2C_WriteByte(0x40);
    
            }
            I2C_WriteByte(font[ind +1 + i]);  // + 1 when WIDTH // Na svakih 47 počinje novi karakter, svaki karakter počinje svojom dužinom pa onda se nastavlja 
                                                                // bajtovima za štampanje, 47 je veliki broj, verovatno je prvobitno izabran za velike fontove
            
        }
        xtemp += font[ind];
     //   w += 2;
        I2C_Stop();
        setXY(xtemp, y);
        
        
    I2C_Start();
    I2C_WriteByte(0x78);
    I2C_WriteByte(0x40);
    
    
        current += 1;
        
    }
    
    I2C_Stop();

}

void setXY(uint8_t x, uint8_t y)
{
    SSD1306_cmd(SSD1306_PAGEADDR);
    SSD1306_cmd(y);              // page start address
    SSD1306_cmd(7);              // page end address, every page consists of 8 rows, 8*8=64px height
    
    SSD1306_cmd(SSD1306_COLUMNADDR);
    SSD1306_cmd(x);
    SSD1306_cmd(127);
}